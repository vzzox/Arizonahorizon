<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="description" content="Omega Private Browser">
    <title>Omega Browser</title>
    <style>
        /* * ------------------------------------------------------------------
         * CORE STYLESHEET - LEVEL 0
         * ------------------------------------------------------------------
         */
        :root {
            --c-void: #000000;
            --c-asphalt: #0f0f0f;
            --c-concrete: #1a1a1a;
            --c-steel: #333333;
            --c-smoke: #888888;
            --c-mist: #b0b0b0;
            --c-flash: #ffffff;
            
            --f-primary: -apple-system, BlinkMacSystemFont, 'Inter', 'Roboto', sans-serif;
            --f-mono: 'JetBrains Mono', 'Fira Code', monospace;
            
            --z-bottom: 10;
            --z-content: 100;
            --z-ui: 500;
            --z-overlay: 1000;
            --z-toast: 2000;
            
            --ease-out: cubic-bezier(0.215, 0.61, 0.355, 1);
            --ease-snap: cubic-bezier(0.33, 1, 0.68, 1);
        }

        /* * ------------------------------------------------------------------
         * RESET & BASE
         * ------------------------------------------------------------------
         */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        html, body { width: 100%; height: 100%; margin: 0; padding: 0; background: var(--c-void); color: var(--c-flash); font-family: var(--f-primary); overflow: hidden; }
        
        /* * ------------------------------------------------------------------
         * UI COMPONENTS
         * ------------------------------------------------------------------
         */
        
        /* --- APP SHELL --- */
        #omega-shell {
            display: flex;
            flex-direction: column;
            height: 100%;
            position: relative;
        }

        /* --- VIEWPORT (Web Content) --- */
        #viewport-stack {
            flex: 1;
            position: relative;
            background: var(--c-asphalt);
            overflow: hidden;
        }

        .browser-tab-view {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: #fff;
            display: none;
            flex-direction: column;
            z-index: var(--z-content);
        }
        
        .browser-tab-view.active { display: flex; }

        iframe.web-engine {
            border: none;
            width: 100%;
            height: 100%;
            background: #fff;
        }

        /* --- OMEGA SEARCH START PAGE (Internal) --- */
        .omega-home {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: var(--c-void);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: var(--z-content);
            padding: 20px;
        }

        .omega-brand {
            font-size: 3rem;
            font-weight: 900;
            letter-spacing: -2px;
            color: var(--c-flash);
            margin-bottom: 30px;
            text-transform: uppercase;
            border: 2px solid var(--c-flash);
            padding: 10px 30px;
            background: transparent;
        }

        .omega-search-box {
            width: 100%;
            max-width: 90%;
            height: 56px;
            background: var(--c-concrete);
            border: 1px solid var(--c-steel);
            border-radius: 8px;
            display: flex;
            align-items: center;
            padding: 0 15px;
            margin-bottom: 40px;
        }

        .omega-search-input {
            width: 100%;
            background: transparent;
            border: none;
            color: var(--c-flash);
            font-size: 18px;
            font-weight: 500;
        }

        .shortcuts-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            width: 100%;
            max-width: 90%;
        }

        .shortcut-item {
            aspect-ratio: 1;
            background: var(--c-concrete);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: var(--c-smoke);
            font-weight: 700;
            cursor: pointer;
            border: 1px solid transparent;
            transition: 0.2s;
        }
        
        .shortcut-item:active { background: var(--c-steel); color: var(--c-flash); }

        /* --- BOTTOM CONTROL BAR --- */
        #control-deck {
            height: 70px; /* Taller for fingers */
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--c-steel);
            display: flex;
            align-items: center;
            padding: 0 10px;
            z-index: var(--z-ui);
            padding-bottom: env(safe-area-inset-bottom);
            gap: 8px;
        }

        .deck-btn {
            width: 44px;
            height: 44px;
            border: none;
            background: transparent;
            color: var(--c-flash);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }
        .deck-btn:active { background: var(--c-steel); }
        .deck-btn svg { width: 24px; height: 24px; fill: currentColor; }

        .omnibox-wrapper {
            flex: 1;
            height: 44px;
            background: var(--c-concrete);
            border-radius: 8px;
            display: flex;
            align-items: center;
            padding: 0 12px;
            border: 1px solid var(--c-steel);
            position: relative;
        }

        .lock-icon { width: 12px; height: 12px; border-radius: 50%; background: var(--c-steel); margin-right: 8px; transition: 0.3s; }
        .lock-icon.secure { background: #00ff00; box-shadow: 0 0 5px #00ff00; }
        
        #url-display {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--c-flash);
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            font-family: var(--f-mono);
        }

        /* --- OVERLAYS (Tabs, Menu) --- */
        .overlay-pane {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--c-void);
            z-index: var(--z-overlay);
            transform: translateY(100%);
            transition: transform 0.35s var(--ease-snap);
            display: flex;
            flex-direction: column;
        }
        
        .overlay-pane.open { transform: translateY(0); }

        .pane-header {
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            border-bottom: 1px solid var(--c-steel);
            background: var(--c-asphalt);
        }
        
        .pane-title { font-weight: 900; letter-spacing: 1px; text-transform: uppercase; font-size: 14px; }

        /* TABS GRID */
        .tabs-container {
            flex: 1;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-auto-rows: 180px;
            gap: 15px;
            overflow-y: auto;
        }

        .tab-card {
            background: var(--c-concrete);
            border: 1px solid var(--c-steel);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }
        .tab-card.active-card { border-color: var(--c-flash); }
        
        .tab-preview { flex: 1; background: #000; display: flex; center; justify-content: center; align-items: center; font-size: 40px; font-weight: bold; color: #333; }
        .tab-meta { height: 40px; background: var(--c-asphalt); display: flex; align-items: center; padding: 0 10px; font-size: 12px; border-top: 1px solid var(--c-steel); }
        .tab-close { position: absolute; top: 5px; right: 5px; width: 30px; height: 30px; background: rgba(0,0,0,0.5); border-radius: 50%; display: flex; align-items: center; justify-content: center; }

        /* DEV CONSOLE */
        .console-log {
            flex: 1;
            padding: 20px;
            font-family: var(--f-mono);
            font-size: 12px;
            color: #0f0;
            overflow-y: auto;
            background: #000;
        }
        .log-entry { margin-bottom: 5px; border-bottom: 1px solid #111; padding-bottom: 2px; }
        .log-time { color: #666; margin-right: 10px; }

        /* TOAST */
        .sys-toast {
            position: fixed;
            top: 20px; left: 50%; transform: translateX(-50%) translateY(-100px);
            background: var(--c-concrete);
            border: 1px solid var(--c-steel);
            padding: 10px 20px;
            border-radius: 50px;
            font-size: 12px;
            z-index: var(--z-toast);
            transition: 0.4s var(--ease-snap);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .sys-toast.show { transform: translateX(-50%) translateY(0); }

    </style>
</head>
<body>

    <div id="omega-shell">
        
        <div id="viewport-stack">
            </div>

        <div id="control-deck">
            <button class="deck-btn" onclick="Kernel.nav.back()">
                <svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
            </button>
            
            <div class="omnibox-wrapper" onclick="Kernel.ui.toggleSearchOverlay()">
                <div class="lock-icon" id="secure-badge"></div>
                <input type="text" id="url-display" placeholder="Omega Search..." readonly>
            </div>

            <button class="deck-btn" onclick="Kernel.ui.toggleTabs()">
                <span style="font-weight:900; font-size:12px; border:2px solid #fff; width:20px; height:20px; display:flex; align-items:center; justify-content:center; border-radius:6px;" id="tab-counter">1</span>
            </button>
            
            <button class="deck-btn" onclick="Kernel.ui.toggleMenu()">
                <svg viewBox="0 0 24 24"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
            </button>
        </div>
    </div>

    <div id="overlay-tabs" class="overlay-pane">
        <div class="pane-header">
            <span class="pane-title">Менеджер процессов</span>
            <button class="deck-btn" onclick="Kernel.ui.toggleTabs()">✕</button>
        </div>
        <div class="tabs-container" id="tabs-grid"></div>
        <div style="padding:20px; border-top:1px solid #333;">
            <button onclick="Kernel.tabs.create()" style="width:100%; padding:15px; background:var(--c-flash); color:#000; border:none; border-radius:50px; font-weight:900;">+ НОВЫЙ ПРОЦЕСС</button>
        </div>
    </div>

    <div id="overlay-menu" class="overlay-pane">
        <div class="pane-header">
            <span class="pane-title">Система</span>
            <button class="deck-btn" onclick="Kernel.ui.toggleMenu()">✕</button>
        </div>
        <div style="padding: 0 20px;">
            <p style="color:#666; font-size:12px; margin-top:20px;">BROWSER ACTIONS</p>
            <div onclick="location.reload()" style="padding:15px 0; border-bottom:1px solid #222;">Перезагрузить ядро</div>
            <div onclick="Kernel.data.clear()" style="padding:15px 0; border-bottom:1px solid #222;">Очистить кэш/куки</div>
            <div onclick="Kernel.ui.toggleDev()" style="padding:15px 0; border-bottom:1px solid #222;">Консоль разработчика</div>
            
            <p style="color:#666; font-size:12px; margin-top:30px;">OMEGA SEARCH</p>
            <div style="padding:15px 0; border-bottom:1px solid #222; display:flex; align-items:center; justify-content:space-between;">
                <span>Поисковик</span>
                <span style="color:#888;">BING (IFRAME)</span>
            </div>
        </div>
        <div style="flex:1"></div>
        <div style="padding:20px; text-align:center; color:#444; font-size:10px;">
            OMEGA CORE v3.0.1<br>STREET MINIMAL BUILD
        </div>
    </div>

    <div id="overlay-dev" class="overlay-pane">
        <div class="pane-header">
            <span class="pane-title" style="color:#0f0;">DEV_LOGS</span>
            <button class="deck-btn" onclick="Kernel.ui.toggleDev()">✕</button>
        </div>
        <div class="console-log" id="sys-log"></div>
    </div>

    <div id="overlay-search" class="overlay-pane" style="background: rgba(0,0,0,0.9);">
        <div style="padding: 20px; display:flex; gap:10px; margin-top:50px;">
             <input type="text" id="master-input" class="omega-search-input" style="border-bottom: 2px solid #fff;" placeholder="Введите URL или запрос..." autocomplete="off">
             <button onclick="Kernel.nav.go()" style="background:#fff; border:none; padding:0 20px; font-weight:bold;">GO</button>
        </div>
        <div style="padding: 20px; color: #666;">
            <p>Прямой доступ к сети через шлюзы.</p>
            <p>http/https поддерживаются.</p>
        </div>
        <div style="flex:1" onclick="Kernel.ui.toggleSearchOverlay()"></div>
    </div>

    <div id="toast" class="sys-toast">System Ready</div>

    <script>
        /**
         * OMEGA KERNEL v3.0
         * Handles Process Isolation, Navigation, and UI State.
         */
        
        const CONFIG = {
            homeUrl: 'omega://home',
            searchGate: 'https://www.bing.com/search?q=', // Using Bing as it's most likely to work in iframe
            maxTabs: 10
        };

        const Kernel = {
            state: {
                tabs: [],
                activeTabId: null,
                history: []
            },

            // --- INITIALIZATION ---
            boot: () => {
                Kernel.log("System booting...");
                Kernel.tabs.create(CONFIG.homeUrl);
                
                // Event Listeners for inputs
                document.getElementById('master-input').addEventListener('keypress', (e) => {
                    if(e.key === 'Enter') Kernel.nav.go();
                });

                Kernel.log("Omega Engine Ready.");
                Kernel.ui.toast("Omega Browser v3.0 Loaded");
            },

            // --- TAB MANAGEMENT (PROCESSES) ---
            tabs: {
                create: (url = CONFIG.homeUrl) => {
                    if (Kernel.state.tabs.length >= CONFIG.maxTabs) {
                        Kernel.ui.toast("Memory Limit Reached (Max Tabs)");
                        return;
                    }

                    const tabId = 'proc_' + Math.random().toString(36).substr(2, 9);
                    Kernel.log(`Spawning process ${tabId}`);

                    const tab = {
                        id: tabId,
                        url: url,
                        title: 'New Tab',
                        dom: null
                    };

                    // Create DOM Structure
                    const view = document.createElement('div');
                    view.className = 'browser-tab-view';
                    view.id = `view-${tabId}`;

                    if (url === CONFIG.homeUrl) {
                        // Render Internal Home
                        view.innerHTML = Kernel.templates.home();
                    } else {
                        // Render Iframe
                        const frame = document.createElement('iframe');
                        frame.className = 'web-engine';
                        frame.src = url;
                        frame.sandbox = "allow-forms allow-scripts allow-same-origin allow-popups"; 
                        view.appendChild(frame);
                    }

                    document.getElementById('viewport-stack').appendChild(view);
                    
                    Kernel.state.tabs.push(tab);
                    tab.dom = view;
                    
                    Kernel.tabs.switch(tabId);
                    Kernel.ui.renderTabs();
                    
                    // Auto-close overlay if open
                    document.getElementById('overlay-tabs').classList.remove('open');
                },

                switch: (id) => {
                    Kernel.state.activeTabId = id;
                    
                    // Hide all
                    document.querySelectorAll('.browser-tab-view').forEach(el => el.classList.remove('active'));
                    
                    // Show active
                    const tab = Kernel.state.tabs.find(t => t.id === id);
                    if(tab) {
                        tab.dom.classList.add('active');
                        Kernel.ui.updateOmnibox(tab.url);
                    }
                },

                close: (e, id) => {
                    e.stopPropagation();
                    if(Kernel.state.tabs.length <= 1) return;

                    Kernel.log(`Killing process ${id}`);
                    
                    const idx = Kernel.state.tabs.findIndex(t => t.id === id);
                    const tab = Kernel.state.tabs[idx];
                    
                    // Remove DOM
                    tab.dom.remove();
                    
                    // Remove from State
                    Kernel.state.tabs.splice(idx, 1);
                    
                    // Switch if active
                    if(Kernel.state.activeTabId === id) {
                        Kernel.tabs.switch(Kernel.state.tabs[Math.max(0, idx - 1)].id);
                    }
                    
                    Kernel.ui.renderTabs();
                }
            },

            // --- NAVIGATION ---
            nav: {
                go: () => {
                    const input = document.getElementById('master-input');
                    let query = input.value.trim();
                    if(!query) return;

                    Kernel.ui.toggleSearchOverlay(); // Close input

                    let dest = '';
                    
                    // Simple URL parsing
                    if (query.match(/^[a-zA-Z0-9-]+\.[a-zA-Z]{2,}/)) {
                         if(!query.startsWith('http')) dest = 'https://' + query;
                         else dest = query;
                    } else {
                        // Use Search Engine
                        dest = CONFIG.searchGate + encodeURIComponent(query);
                    }

                    Kernel.nav.load(dest);
                    input.value = '';
                },

                load: (url) => {
                    const activeTab = Kernel.state.tabs.find(t => t.id === Kernel.state.activeTabId);
                    if(!activeTab) return;

                    Kernel.log(`Navigating to ${url}`);
                    
                    // Clear current view
                    activeTab.dom.innerHTML = '';
                    
                    // Create new frame
                    const frame = document.createElement('iframe');
                    frame.className = 'web-engine';
                    frame.src = url;
                    // Note: Many big sites block iframes (X-Frame-Options). 
                    // This is a browser limitation, not code limitation.
                    frame.onload = () => { Kernel.log("Resource loaded"); };
                    frame.onerror = () => { Kernel.log("Load error (likely CORS/Frame-Block)"); };
                    
                    activeTab.dom.appendChild(frame);
                    activeTab.url = url;
                    activeTab.title = url; // Temp title
                    
                    Kernel.ui.updateOmnibox(url);
                    Kernel.ui.renderTabs();
                },

                back: () => {
                    Kernel.ui.toast("Back (History Stack Empty)");
                }
            },

            // --- UI MANAGERS ---
            ui: {
                toggleTabs: () => {
                    document.getElementById('overlay-tabs').classList.toggle('open');
                    Kernel.ui.renderTabs();
                },
                toggleMenu: () => document.getElementById('overlay-menu').classList.toggle('open'),
                toggleDev: () => document.getElementById('overlay-dev').classList.toggle('open'),
                toggleSearchOverlay: () => {
                    const el = document.getElementById('overlay-search');
                    el.classList.toggle('open');
                    if(el.classList.contains('open')) document.getElementById('master-input').focus();
                },

                renderTabs: () => {
                    const grid = document.getElementById('tabs-grid');
                    grid.innerHTML = '';
                    document.getElementById('tab-counter').innerText = Kernel.state.tabs.length;

                    Kernel.state.tabs.forEach(tab => {
                        const isActive = tab.id === Kernel.state.activeTabId;
                        const el = document.createElement('div');
                        el.className = `tab-card ${isActive ? 'active-card' : ''}`;
                        el.onclick = () => Kernel.tabs.switch(tab.id);
                        
                        let displayTitle = tab.url === CONFIG.homeUrl ? 'Omega Start' : tab.url;
                        if(displayTitle.length > 25) displayTitle = displayTitle.substring(0,25) + '...';

                        el.innerHTML = `
                            <div class="tab-close" onclick="Kernel.tabs.close(event, '${tab.id}')">✕</div>
                            <div class="tab-preview">
                                ${tab.url === CONFIG.homeUrl ? 'Ω' : 'WWW'}
                            </div>
                            <div class="tab-meta">${displayTitle}</div>
                        `;
                        grid.appendChild(el);
                    });
                },

                updateOmnibox: (url) => {
                    const display = document.getElementById('url-display');
                    const badge = document.getElementById('secure-badge');
                    
                    if(url === CONFIG.homeUrl) {
                        display.value = "";
                        display.placeholder = "Omega Search...";
                        badge.className = "lock-icon";
                    } else {
                        display.value = url;
                        if(url.startsWith('https')) badge.className = "lock-icon secure";
                        else badge.className = "lock-icon";
                    }
                },

                toast: (msg) => {
                    const t = document.getElementById('toast');
                    t.innerText = msg;
                    t.classList.add('show');
                    setTimeout(() => t.classList.remove('show'), 3000);
                }
            },

            // --- UTILS ---
            data: {
                clear: () => {
                    localStorage.clear();
                    Kernel.ui.toast("System Wiped");
                    setTimeout(() => location.reload(), 1000);
                }
            },

            log: (msg) => {
                const con = document.getElementById('sys-log');
                const time = new Date().toLocaleTimeString();
                con.innerHTML += `<div class="log-entry"><span class="log-time">[${time}]</span> ${msg}</div>`;
                con.scrollTop = con.scrollHeight;
            },

            templates: {
                home: () => `
                    <div class="omega-home">
                        <div class="omega-brand">Omega</div>
                        <div class="omega-search-box" onclick="Kernel.ui.toggleSearchOverlay()">
                            <span style="color:#666;">Поиск в даркнете (шутка)...</span>
                        </div>
                        <div class="shortcuts-grid">
                            <div class="shortcut-item" onclick="Kernel.nav.load('https://bing.com')">BING</div>
                            <div class="shortcut-item" onclick="Kernel.nav.load('https://duckduckgo.com')">DDG</div>
                            <div class="shortcut-item" onclick="Kernel.nav.load('https://wikipedia.org')">WIKI</div>
                            <div class="shortcut-item" onclick="Kernel.nav.load('https://reddit.com')">RED</div>
                        </div>
                    </div>
                `
            }
        };

        // BOOTSTRAP
        window.onload = Kernel.boot;

    </script>
</body>
</html>
